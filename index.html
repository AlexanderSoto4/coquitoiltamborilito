<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coquito il Tamborilito Stickers</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-yellow-50 font-sans">
  <header class="bg-yellow-200 p-4 shadow-md">
    <h1 class="text-3xl font-bold text-center">Coquito il Tamborilito Stickers</h1>
  </header>

  <main class="p-6 max-w-4xl mx-auto">
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-10">
      <img src="public/coquito.PNG" alt="Coquito Sticker" class="w-full h-64 object-contain" />
      <div class="p-4">
        <h2 class="text-xl font-bold">Coquito Classic Sticker</h2>
        <p class="text-gray-600 mt-2">Sticker de vinil brillante y duradero. Tamaño 3x3 pulgadas.</p>
        <p class="mt-4 font-bold text-lg">$3.00 USD</p>

        <!-- Input de correo electrónico -->
        <input type="email" id="customer-email" placeholder="Tu correo electrónico" class="w-full mt-2 p-2 border rounded" required>

        <!-- Botón de pago -->
        <button id="checkout-button" class="mt-2 bg-yellow-300 hover:bg-yellow-400 text-black font-semibold py-2 px-4 rounded w-full">
          Comprar ahora
        </button>

        <p id="stock-message" class="text-red-600 font-semibold text-center mt-2 hidden">¡Producto agotado!</p>
      </div>
    </div>
  </main>

  <script>
    const stripe = Stripe("pk_live_TU_CLAVE_PUBLICABLE");
    const maxOrders = 100;
    const button = document.getElementById("checkout-button");
    const message = document.getElementById("stock-message");
    const emailInput = document.getElementById("customer-email");
    const sheetEndpoint = "https://script.google.com/macros/s/TU_ENDPOINT/exec";

    function updateStockStatus(totalOrders) {
      if (totalOrders >= maxOrders) {
        button.disabled = true;
        button.classList.add("opacity-50", "cursor-not-allowed");
        message.classList.remove("hidden");
      }
    }

    fetch(sheetEndpoint)
      .then(response => response.json())
      .then(data => {
        let totalOrders = data.totalOrders || 0;
        updateStockStatus(totalOrders);

        button.addEventListener("click", function () {
          const customerEmail = emailInput.value.trim();
          if (!customerEmail) {
            alert("Por favor ingresa tu correo electrónico.");
            return;
          }

          stripe.redirectToCheckout({
            lineItems: [{ price: "price_TU_PRICE_ID", quantity: 1 }],
            mode: "payment",
            successUrl: window.location.href + "?success=true",
            cancelUrl: window.location.href + "?canceled=true",
            customerEmail: customerEmail
          }).then(function (result) {
            if (result.error) {
              alert(result.error.message);
            } else {
              fetch(sheetEndpoint, { method: "POST" });
            }
          });
        });
      });
  </script>
</body>
</html>